/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{476:function(Aa,xa,r){r.r(xa);var oa=r(0),na=r(8),ma=r(2);Aa=r(48);var fa=r(23),da=r(11);r=function(){function aa(){this.init()}aa.prototype.init=function(){this.V9=!1;this.ef=this.Ql=this.connection=null;this.Hs={};this.fa=this.yG=null};aa.prototype.Fqa=function(y){for(var w=this,f=0;f<y.length;++f){var a=y[f];switch(a.at){case "create":this.Hs[a.author]||(this.Hs[a.author]=a.aName);this.$ga(a);break;case "modify":this.fa.Bm(a.xfdf).then(function(b){w.fa.ib(b[0])});
break;case "delete":this.fa.Bm("<delete><id>"+a.aId+"</id></delete>")}}};aa.prototype.$ga=function(y){var w=this;this.fa.Bm(y.xfdf).then(function(f){f=f[0];f.authorId=y.author;w.fa.ib(f);w.fa.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[f])})};aa.prototype.Bga=function(y,w,f){this.Ql&&this.Ql(y,w,f)};aa.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Bga.bind(this,y,"add",{imported:!1}),{once:!0})};aa.prototype.initiateCollaboration=function(y,
w,f){var a=this;if(y){a.ef=w;a.fa=f.ka();f.addEventListener(na.f.DOCUMENT_UNLOADED,function(){a.disableCollaboration()});a.fra(y);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var e=JSON.parse(b.responseText);a.connection=exports.Ua.Sra(Object(fa.k)(a.ef,"blackbox/"),"annot");a.yG=e.id;a.Hs[e.id]=e.user_name;a.fa.TN(e.id);a.connection.Mua(function(h){h.t&&h.t.startsWith("a_")&&h.data&&a.Fqa(h.data)},function(){a.connection.send({t:"a_retrieve",
dId:y});a.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[a.Hs[e.id],a.yG])},function(){a.disableCollaboration()})}catch(h){Object(ma.g)(h.message)}});b.open("GET",Object(fa.k)(this.ef,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();a.V9=!0;a.fa.l0(function(e){return a.Hs[e.Author]||e.Author})}else Object(ma.g)("Document ID required for collaboration")};aa.prototype.disableCollaboration=function(){this.Ql&&(this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ql),this.Ql=
null);this.connection&&this.connection.qq();this.fa&&this.fa.TN("Guest");this.init();this.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};aa.prototype.fra=function(y){var w=this;this.Ql&&this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ql);this.Ql=function(f,a,b){return Object(oa.b)(this,void 0,void 0,function(){var e,h,n,z,x,ba,ia,ca,ea;return Object(oa.d)(this,function(ja){switch(ja.label){case 0:if(b.imported)return[2];e={t:"a_"+a,dId:y,annots:[]};return[4,w.fa.UJ()];case 1:h=
ja.ca();"delete"!==a&&(n=(new DOMParser).parseFromString(h,"text/xml"),z=new XMLSerializer);for(x=0;x<f.length;x++)ba=f[x],ca=ia=void 0,"add"===a?(ia=n.querySelector('[name="'+ba.Id+'"]'),ca=z.serializeToString(ia),ea=null,ba.InReplyTo&&(ea=w.fa.vf(ba.InReplyTo).authorId||"default"),e.annots.push({at:"create",aId:ba.Id,author:w.yG,aName:w.Hs[w.yG],parent:ea,xfdf:"<add>"+ca+"</add>"})):"modify"===a?(ia=n.querySelector('[name="'+ba.Id+'"]'),ca=z.serializeToString(ia),e.annots.push({at:"modify",aId:ba.Id,
xfdf:"<modify>"+ca+"</modify>"})):"delete"===a&&e.annots.push({at:"delete",aId:ba.Id});0<e.annots.length&&w.connection.send(e);return[2]}})})}.bind(w);this.fa.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ql)};aa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return aa}();Object(Aa.a)(r);xa["default"]=r}}]);}).call(this || window)
